<!-- Executive Dashboard Header -->
<div
  class="bg-gradient-to-r from-slate-800 to-slate-700 text-white rounded-t-lg p-4 sm:p-5 flex flex-wrap sm:flex-nowrap justify-between items-center"
>
  <h2 class="text-lg sm:text-xl font-bold w-full sm:w-auto">
    <i class="fas fa-history mr-2"></i>Trading History Dashboard
  </h2>
  <div class="flex items-center mt-2 sm:mt-0 w-full sm:w-auto justify-end">
    <span class="text-sm opacity-80 mr-3">{{ symbol }}</span>
    <span class="bg-blue-500 text-xs font-bold px-2.5 py-1 rounded"
      >REPORT</span
    >
  </div>
</div>

<!-- Date Range Filter -->
<div class="bg-white p-4 border-b border-slate-200">
  <form
    id="history-filter-form"
    action="/filter_history"
    method="get"
    class="flex flex-wrap items-end gap-4"
  >
    <div>
      <label class="block text-xs font-medium text-slate-700 mb-1"
        >From Date</label
      >
      <input
        type="date"
        name="from_date"
        value="{{ from_date }}"
        class="text-sm bg-white border border-slate-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none"
      />
    </div>
    <div>
      <label class="block text-xs font-medium text-slate-700 mb-1"
        >To Date</label
      >
      <input
        type="date"
        name="to_date"
        value="{{ to_date }}"
        class="text-sm bg-white border border-slate-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none"
      />
    </div>
    <div>
      <button
        type="submit"
        class="bg-blue-500 hover:bg-blue-600 text-white rounded-md px-4 py-2 text-sm flex items-center"
      >
        <i class="fas fa-filter mr-2"></i> Filter History
      </button>
    </div>
    <div>
      <a
        href="/"
        class="bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-md px-4 py-2 text-sm flex items-center"
      >
        <i class="fas fa-redo mr-2"></i> Reset Filter
      </a>
    </div>
  </form>
</div>

<!-- Key Metrics Bar -->
<div
  class="bg-white grid grid-cols-2 sm:grid-cols-4 divide-y sm:divide-y-0 sm:divide-x divide-slate-200 shadow-md"
>
  {% set total_trades = history|length if history else 0 %} {% set
  profitable_trades = history|selectattr('profit', 'ge', 0)|list|length if
  history else 0 %} {% set win_rate = (profitable_trades / total_trades *
  100)|round if total_trades > 0 else 0 %} {% set total_profit =
  history|sum(attribute='profit') if history else 0 %}

  <div class="p-3 sm:p-5 text-center">
    <p
      class="text-xs uppercase tracking-wider text-slate-500 mb-1 sm:mb-2 font-medium"
    >
      Total Trades
    </p>
    <p class="text-base sm:text-lg font-bold">{{ total_trades }}</p>
  </div>
  <div class="p-3 sm:p-5 text-center">
    <p
      class="text-xs uppercase tracking-wider text-slate-500 mb-1 sm:mb-2 font-medium"
    >
      Win Rate
    </p>
    <p class="text-base sm:text-lg font-bold">{{ win_rate }}%</p>
  </div>
  <div class="p-3 sm:p-5 text-center">
    <p
      class="text-xs uppercase tracking-wider text-slate-500 mb-1 sm:mb-2 font-medium"
    >
      Total P/L
    </p>
    <p
      class="text-base sm:text-lg font-bold {% if total_profit >= 0 %}text-emerald-600{% else %}text-red-600{% endif %}"
    >
      <i
        class="fas {% if total_profit >= 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %} mr-1"
      ></i>
      {{ total_profit }}
    </p>
  </div>
  <div class="p-3 sm:p-5 text-center">
    <p
      class="text-xs uppercase tracking-wider text-slate-500 mb-1 sm:mb-2 font-medium"
    >
      Avg. Profit/Loss
    </p>
    <p class="text-base sm:text-lg font-bold">
      {% if total_trades > 0 %} {{ (total_profit / total_trades)|round(2) }} {%
      else %} 0 {% endif %}
    </p>
  </div>
</div>

<!-- Dashboard Main Content -->
<div class="p-4 sm:p-6 bg-slate-50 mt-4 sm:mt-6">
  <div class="bg-white rounded-lg shadow-card">
    <div class="border-b p-3 sm:p-4 flex justify-between items-center">
      <h3 class="font-semibold text-slate-800">Trading Performance</h3>
      <div class="flex items-center space-x-2">
        <span class="text-xs text-slate-500">
          Showing trades from
          <span class="font-medium">{{ from_date }}</span> to
          <span class="font-medium">{{ to_date }}</span>
        </span>
      </div>
    </div>

    <div class="overflow-x-auto mobile-scroll-x">
      {% if history %}
      <table class="min-w-full">
        <thead>
          <tr class="bg-slate-50">
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Ticket
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Symbol
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Type
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Volume
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Entry
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Exit
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              P/L Status
            </th>
            <th
              class="py-3 px-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"
            >
              Profit
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200">
          {% for trade in history %}
          <tr class="hover:bg-slate-50">
            <td class="py-3 px-4 whitespace-nowrap font-medium text-slate-700">
              {{ trade.ticket }}
            </td>
            <td class="py-3 px-4 whitespace-nowrap">{{ trade.symbol }}</td>
            <td class="py-3 px-4 whitespace-nowrap">
              <span
                class="px-2 py-1 text-xs rounded-full {{ 'bg-emerald-100 text-emerald-800' if trade.type == 'BUY' else 'bg-red-100 text-red-800' }}"
              >
                {{ trade.type }}
              </span>
            </td>
            <td class="py-3 px-4 whitespace-nowrap">{{ trade.volume }}</td>
            <td class="py-3 px-4 whitespace-nowrap">{{ trade.price_open }}</td>
            <td class="py-3 px-4 whitespace-nowrap">{{ trade.price_close }}</td>
            <td class="py-3 px-4 whitespace-nowrap">
              <div class="flex items-center">
                <div
                  class="w-2 h-8 rounded-l-full {{ 'bg-emerald-500' if trade.profit >= 0 else 'bg-red-500' }}"
                ></div>
                <div
                  class="w-16 h-8 rounded-r-full flex items-center justify-center {{ 'bg-emerald-100 text-emerald-800' if trade.profit >= 0 else 'bg-red-100 text-red-800' }}"
                >
                  {{ 'WIN' if trade.profit >= 0 else 'LOSS' }}
                </div>
              </div>
            </td>
            <td
              class="py-3 px-4 whitespace-nowrap font-medium {{ 'text-emerald-600' if trade.profit >= 0 else 'text-red-600' }}"
            >
              {{ trade.profit }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="py-12 text-center">
        <div
          class="mx-auto w-16 h-16 mb-4 bg-slate-100 rounded-full flex items-center justify-center"
        >
          <i class="fas fa-chart-line text-slate-400 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-slate-700 mb-2">
          No Trading History
        </h3>
        <p class="text-sm text-slate-500 max-w-md mx-auto">
          There's no trading history available for this date range. Try
          adjusting your filter or check back after some trades are completed.
        </p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
