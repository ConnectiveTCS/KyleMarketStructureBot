<div class="col-span-1 lg:col-span-8">
  <div class="bg-white rounded-lg shadow-card h-full">
    <div class="border-b p-3 sm:p-4">
      <h3 class="font-semibold text-slate-800">
        Stochastic Oscillator Analysis
      </h3>
    </div>
    <div class="p-3 sm:p-5">
      <!-- Stochastic Visualization -->
      <div class="mb-6">
        <div class="border rounded-lg p-4 bg-slate-50">
          <h4 class="text-sm font-medium text-slate-700 mb-3">
            Stochastic Oscillator
          </h4>

          <!-- Stochastic Oscillator Visual Gauge -->
          <div
            class="h-24 relative mb-2 bg-slate-200 rounded-md overflow-hidden"
          >
            <!-- Overbought Zone -->
            <div
              class="absolute top-0 left-0 right-0 h-20% bg-red-100 border-b border-red-200 flex items-center justify-center"
            >
              <span class="text-xs text-red-500 font-medium"
                >Overbought Zone (> {{ config.stoch_overbought }})</span
              >
            </div>

            <!-- Normal Zone -->
            <div
              class="absolute top-20% left-0 right-0 h-60% bg-blue-50 flex items-center justify-center"
            >
              <span class="text-xs text-blue-500 font-medium"
                >Neutral Zone</span
              >
            </div>

            <!-- Oversold Zone -->
            <div
              class="absolute bottom-0 left-0 right-0 h-20% bg-green-100 border-t border-green-200 flex items-center justify-center"
            >
              <span class="text-xs text-green-500 font-medium"
                >Oversold Zone (< {{ config.stoch_oversold }})</span
              >
            </div>

            <!-- K and D Lines -->
            {% if stochastic and stochastic.k_value and stochastic.d_value %} {%
            set k_position = 100 - stochastic.k_value %} {% set d_position = 100
            - stochastic.d_value %}

            <div
              class="absolute h-1 bg-blue-600 left-0 right-0"
              style="top: {{ d_position }}%"
            ></div>
            <div
              class="absolute w-1 h-1 rounded-full bg-blue-600 right-2"
              style="top: {{ d_position }}%"
            ></div>

            <div
              class="absolute h-1 bg-orange-500 left-0 right-0"
              style="top: {{ k_position }}%"
            ></div>
            <div
              class="absolute w-1 h-1 rounded-full bg-orange-500 right-2"
              style="top: {{ k_position }}%"
            ></div>
            {% endif %}
          </div>

          <!-- Legend -->
          <div class="flex justify-center items-center space-x-4 text-xs">
            <div class="flex items-center">
              <div class="w-3 h-1 bg-orange-500 mr-1"></div>
              <span
                >%K: {{ stochastic.k_value|round(1) if stochastic and
                stochastic.k_value else 'N/A' }}</span
              >
            </div>
            <div class="flex items-center">
              <div class="w-3 h-1 bg-blue-600 mr-1"></div>
              <span
                >%D: {{ stochastic.d_value|round(1) if stochastic and
                stochastic.d_value else 'N/A' }}</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Trend Status -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
        <div class="border rounded-lg p-4 text-center">
          <h4
            class="text-xs uppercase tracking-wider text-slate-500 mb-2 font-medium"
          >
            Trend Status
          </h4>
          <div class="flex justify-center items-center">
            <div
              class="w-3 h-3 rounded-full mt-1 mr-2 {% if stochastic and stochastic.trend == 'uptrend' %}bg-emerald-500 {% elif stochastic and stochastic.trend == 'downtrend' %}bg-red-500 {% else %}bg-slate-400{% endif %}"
            ></div>
            <p
              class="text-base sm:text-lg font-bold {% if stochastic and stochastic.trend == 'uptrend' %}text-emerald-600 {% elif stochastic and stochastic.trend == 'downtrend' %}text-red-600 {% else %}text-slate-600{% endif %}"
            >
              {{ stochastic.trend|default('Neutral')|title if stochastic else
              'Undefined' }}
            </p>
          </div>
        </div>

        <div class="border rounded-lg p-4 text-center">
          <h4
            class="text-xs uppercase tracking-wider text-slate-500 mb-2 font-medium"
          >
            %K Value
          </h4>
          <p
            class="text-base sm:text-lg font-bold {% if stochastic and stochastic.k_value < config.stoch_oversold %}text-emerald-600 {% elif stochastic and stochastic.k_value > config.stoch_overbought %}text-red-600 {% else %}text-slate-600{% endif %}"
          >
            {{ stochastic.k_value|round(1) if stochastic and stochastic.k_value
            else 'N/A' }}
          </p>
        </div>

        <div class="border rounded-lg p-4 text-center">
          <h4
            class="text-xs uppercase tracking-wider text-slate-500 mb-2 font-medium"
          >
            %D Value
          </h4>
          <p
            class="text-base sm:text-lg font-bold {% if stochastic and stochastic.d_value < config.stoch_oversold %}text-emerald-600 {% elif stochastic and stochastic.d_value > config.stoch_overbought %}text-red-600 {% else %}text-slate-600{% endif %}"
          >
            {{ stochastic.d_value|round(1) if stochastic and stochastic.d_value
            else 'N/A' }}
          </p>
        </div>
      </div>

      <!-- Signal Status -->
      <div class="mt-6 border-t pt-4">
        <h4 class="font-medium text-sm mb-3 text-slate-700">Signal Status</h4>

        {% if stochastic and stochastic.signal %}
        <div
          class="p-3 rounded-md {% if stochastic.signal == 'buy' %}bg-emerald-100 text-emerald-800 border border-emerald-200 {% elif stochastic.signal == 'sell' %}bg-red-100 text-red-800 border border-red-200 {% else %}bg-slate-100 text-slate-800 border border-slate-200{% endif %}"
        >
          <div class="flex items-center">
            <i
              class="fas {% if stochastic.signal == 'buy' %}fa-arrow-up text-emerald-500 {% elif stochastic.signal == 'sell' %}fa-arrow-down text-red-500 {% else %}fa-minus text-slate-500{% endif %} mr-2"
            ></i>
            <span class="font-medium">
              {% if stochastic.signal == 'buy' %}BUY Signal Detected {% elif
              stochastic.signal == 'sell' %}SELL Signal Detected {% else %}No
              Signal{% endif %}
            </span>
          </div>
        </div>
        {% else %}
        <div
          class="p-3 rounded-md bg-slate-100 text-slate-800 border border-slate-200"
        >
          <div class="flex items-center">
            <i class="fas fa-minus text-slate-500 mr-2"></i>
            <span class="font-medium">Waiting for Signal</span>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
