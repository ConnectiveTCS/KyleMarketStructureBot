<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <title>Market Structure Bot Dashboard</title>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#1e40af',
              secondary: '#475569',
              success: '#10b981',
              danger: '#ef4444',
              warning: '#f59e0b',
              info: '#3b82f6',
            }
          }
        }
      }
    </script>
    <style>
      .sidebar {
        min-height: calc(100vh - 2rem);
      }
      .status-badge {
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .status-running {
        background-color: #dcfce7;
        color: #15803d;
      }
      .status-stopped {
        background-color: #fee2e2;
        color: #b91c1c;
      }
      .dashboard-card {
        transition: all 0.2s ease-in-out;
      }
      .dashboard-card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }
      .market-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
      }
      .indicator-bull {
        background-color: #10b981;
      }
      .indicator-bear {
        background-color: #ef4444;
      }
      .indicator-neutral {
        background-color: #9ca3af;
      }
      header {
        background: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .header-brand {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1e40af;
      }
      .header-btn {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem;
        border-radius: 0.375rem;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-700">
    <!-- header -->
    <header class="flex items-center justify-between px-6 py-4">
      <div class="flex items-center space-x-4">
        <button id="nav-toggle" class="md:hidden header-btn bg-gray-100 hover:bg-gray-200">
          <i class="fas fa-bars"></i>
        </button>
        <div class="header-brand flex items-center">
          <i class="fas fa-chart-line mr-2"></i>Market Structure
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <span class="status-badge {{ 'status-running' if status=='running' else 'status-stopped' }}">
          {{ status.upper() }}
        </span>
        <a href="/" class="header-btn bg-info text-white hover:bg-info/90">
          <i class="fas fa-sync-alt mr-1"></i>Refresh
        </a>
      </div>
    </header>

    <div class="flex">
      <!-- sidebar -->
      <aside class="sidebar bg-white shadow-md w-64 hidden md:block p-4">
        <div class="mb-10">
          <h1 class="text-2xl font-bold text-primary mb-1">
            <i class="fas fa-chart-line mr-2"></i>Market Structure
          </h1>
          <p class="text-sm text-gray-500">Trading Bot Dashboard</p>
        </div>
        
        <nav>
          <div class="mb-8">
            <p class="text-xs uppercase font-semibold text-gray-500 mb-4 tracking-wider">
              Bot Controls
            </p>
            <div class="space-y-2">
              <a href="/start" class="flex items-center p-2 rounded hover:bg-gray-100 text-success">
                <i class="fas fa-play mr-3 w-5 text-center"></i>
                <span>Start Bot</span>
              </a>
              <a href="/stop" class="flex items-center p-2 rounded hover:bg-gray-100 text-danger">
                <i class="fas fa-stop mr-3 w-5 text-center"></i>
                <span>Stop Bot</span>
              </a>
              <a href="/" class="flex items-center p-2 rounded hover:bg-gray-100 text-info">
                <i class="fas fa-sync-alt mr-3 w-5 text-center"></i>
                <span>Refresh Data</span>
              </a>
            </div>
          </div>
          
          <div class="mb-8">
            <p class="text-xs uppercase font-semibold text-gray-500 mb-4 tracking-wider">
              Monitoring
            </p>
            <div class="space-y-2">
              <button onclick="showSection('market_structure')" class="nav-btn flex items-center p-2 rounded hover:bg-gray-100 w-full text-left">
                <i class="fas fa-chart-bar mr-3 w-5 text-center"></i>
                <span>Market Structure</span>
              </button>
              <button onclick="showSection('positions')" class="nav-btn flex items-center p-2 rounded hover:bg-gray-100 w-full text-left">
                <i class="fas fa-list-ul mr-3 w-5 text-center"></i>
                <span>Open Positions</span>
              </button>
              <button onclick="showSection('history')" class="nav-btn flex items-center p-2 rounded hover:bg-gray-100 w-full text-left">
                <i class="fas fa-history mr-3 w-5 text-center"></i>
                <span>Trading History</span>
              </button>
              <button onclick="showSection('account')" class="nav-btn flex items-center p-2 rounded hover:bg-gray-100 w-full text-left">
                <i class="fas fa-wallet mr-3 w-5 text-center"></i>
                <span>Account Info</span>
              </button>
              <button onclick="showSection('config')" class="nav-btn flex items-center p-2 rounded hover:bg-gray-100 w-full text-left">
                <i class="fas fa-cog mr-3 w-5 text-center"></i>
                <span>Configuration</span>
              </button>
            </div>
          </div>
        </nav>
      </aside>

      <!-- main content -->
      <main class="flex-1 overflow-auto p-6">
        <!-- Dashboard Sections -->
        <div class="section-container">
          <!-- Market Structure Section -->
          <div id="market_structure" class="dashboard-section">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-chart-bar mr-2 text-primary"></i>Market Structure Analysis
              </h2>
              <p class="text-sm text-gray-500">{{ symbol }} - {{ timeframe }}</p>
            </div>
            
            <!-- Multi‐Timeframe Summary -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              {% for ms in market_structures %}
              <div class="dashboard-card bg-white p-4 rounded text-center">
                <h4 class="font-medium">{{ ms.timeframe }}</h4>
                <i class="fas 
                  {% if ms.market_direction=='bull' %}fa-arrow-up text-success{% elif ms.market_direction=='bear' %}fa-arrow-down text-danger{% else %}fa-minus text-secondary{% endif %}
                text-2xl my-2"></i>
                <p class="text-sm">{{ ms.market_direction|default('Neutral')|title }}</p>
              </div>
              {% endfor %}
            </div>

            <!-- existing two‐card grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- Market Direction Card -->
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center mb-4">
                  <div class="mr-4 p-3 rounded-full 
                    {% if market_direction == 'bull' %}bg-green-100 text-green-600
                    {% elif market_direction == 'bear' %}bg-red-100 text-red-600
                    {% else %}bg-gray-100 text-gray-600{% endif %}">
                    <i class="{% if market_direction == 'bull' %}fas fa-arrow-up{% elif market_direction == 'bear' %}fas fa-arrow-down{% else %}fas fa-minus{% endif %}"></i>
                  </div>
                  <div>
                    <h3 class="text-sm font-semibold text-gray-500">Market Direction</h3>
                    <p class="text-2xl font-bold 
                      {% if market_direction == 'bull' %}text-green-600
                      {% elif market_direction == 'bear' %}text-red-600
                      {% else %}text-gray-600{% endif %}">
                      {{ market_direction|title if market_direction else 'Neutral' }}
                    </p>
                  </div>
                </div>
                <div class="text-sm text-gray-500 mb-4">
                  <i class="fas fa-info-circle mr-1"></i>Current market structure direction
                </div>
                <div class="border-t pt-4">
                  <h4 class="font-medium mb-2">Explanation:</h4>
                  <p class="text-sm text-gray-600">
                    {% if market_direction == 'bull' %}
                      Price has broken above the last significant pivot high, indicating bullish momentum.
                      The bot looks to enter long positions in this market structure.
                    {% elif market_direction == 'bear' %}
                      Price has broken below the last significant pivot low, indicating bearish momentum.
                      The bot looks to enter short positions in this market structure.
                    {% else %}
                      No clear market structure break has been detected.
                      The bot will wait for a clear directional signal.
                    {% endif %}
                  </p>
                </div>
              </div>
              
              <!-- Recent Pivots Card -->
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">Recent Pivot Points</h3>
                
                <div class="space-y-4">
                  <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-2">Last Pivot High</h4>
                    {% if last_pivot_high %}
                    <div class="flex items-center">
                      <div class="market-indicator indicator-bull"></div>
                      <p class="font-bold">{{ last_pivot_high }}</p>
                      <span class="text-xs text-gray-500 ml-2">({{ pivot_high_time }})</span>
                    </div>
                    {% else %}
                    <p class="text-gray-500 italic">No recent pivot high detected</p>
                    {% endif %}
                  </div>
                  
                  <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-2">Last Pivot Low</h4>
                    {% if last_pivot_low %}
                    <div class="flex items-center">
                      <div class="market-indicator indicator-bear"></div>
                      <p class="font-bold">{{ last_pivot_low }}</p>
                      <span class="text-xs text-gray-500 ml-2">({{ pivot_low_time }})</span>
                    </div>
                    {% else %}
                    <p class="text-gray-500 italic">No recent pivot low detected</p>
                    {% endif %}
                  </div>
                  
                  <div class="border-t pt-4 mt-4">
                    <h4 class="text-sm font-medium text-gray-500 mb-2">Current Price</h4>
                    <div class="flex items-center">
                      <div class="market-indicator {% if current_price > last_pivot_high %}indicator-bull{% elif current_price < last_pivot_low %}indicator-bear{% else %}indicator-neutral{% endif %}"></div>
                      <p class="font-bold">{{ current_price }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Overall Direction Banner -->
            <div class="mb-6 p-4 bg-gray-100 rounded text-center">
              <span class="font-semibold">Overall Direction:</span>
              <span class="font-bold text-lg 
                {% if overall_direction=='bull' %}text-success{% elif overall_direction=='bear' %}text-danger{% else %}text-secondary{% endif %}">
                {{ overall_direction|default('Neutral')|title }}
              </span>
            </div>

            <!-- Market Structure Strategy Card -->
            <div class="bg-white rounded-lg shadow-sm p-6">
              <h3 class="text-lg font-semibold mb-4">Market Structure Strategy</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h4 class="font-medium text-primary mb-2">
                    <i class="fas fa-arrow-up mr-1 text-green-600"></i>Bullish Structure
                  </h4>
                  <ul class="list-disc ml-5 space-y-2 text-sm">
                    <li>Identify significant pivot highs in price action</li>
                    <li>Wait for price to close above the most recent pivot high</li>
                    <li>Enter long position after confirmation of the break</li>
                    <li>Place stop loss below recent swing low for protection</li>
                    <li>Target profit based on the configured ratio</li>
                  </ul>
                </div>
                
                <div>
                  <h4 class="font-medium text-primary mb-2">
                    <i class="fas fa-arrow-down mr-1 text-red-600"></i>Bearish Structure
                  </h4>
                  <ul class="list-disc ml-5 space-y-2 text-sm">
                    <li>Identify significant pivot lows in price action</li>
                    <li>Wait for price to close below the most recent pivot low</li>
                    <li>Enter short position after confirmation of the break</li>
                    <li>Place stop loss above recent swing high for protection</li>
                    <li>Target profit based on the configured ratio</li>
                  </ul>
                </div>
              </div>
              
              <div class="mt-6 bg-gray-50 p-4 rounded text-sm">
                <p class="font-medium mb-2">Technical Implementation:</p>
                <p>
                  The bot analyzes {{ config.lookback }} candles on the {{ timeframe }} timeframe to identify market structure. 
                  It finds pivot points by comparing each candle to its neighbors and detects structure breaks when price moves beyond these pivots. 
                  The bot can manage up to {{ config.max_positions }} simultaneous positions with a lot size of {{ config.lot_size }}.
                </p>
              </div>
            </div>

            <!-- Strategy Condition Checks Card -->
            <div class="bg-white rounded-lg shadow-sm p-6 mt-6">
              <h3 class="text-lg font-semibold mb-4">Strategy Condition Checks</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h4 class="font-medium text-primary mb-2">Buy Conditions</h4>
                  <ul class="list-none space-y-2">
                    <li>
                      {% if last_pivot_high %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Pivot high detected
                    </li>
                    <li>
                      {% if market_direction == 'bull' %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Price broke above last pivot high
                    </li>
                    <li>
                      {% if current_price and last_pivot_high and current_price > last_pivot_high %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Current price above pivot high
                    </li>
                  </ul>
                </div>
                <div>
                  <h4 class="font-medium text-primary mb-2">Sell Conditions</h4>
                  <ul class="list-none space-y-2">
                    <li>
                      {% if last_pivot_low %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Pivot low detected
                    </li>
                    <li>
                      {% if market_direction == 'bear' %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Price broke below last pivot low
                    </li>
                    <li>
                      {% if current_price and last_pivot_low and current_price < last_pivot_low %}
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                      {% else %}
                        <i class="fas fa-times-circle text-red-500 mr-2"></i>
                      {% endif %}
                      Current price below pivot low
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Positions Section -->
          <div id="positions" class="dashboard-section hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-list-ul mr-2 text-primary"></i>Open Positions
              </h2>
              <p class="text-sm text-gray-500">{{ positions|length if positions else 0 }} positions</p>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full">
                  <thead>
                    <tr class="bg-gray-50">
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbol</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SL/TP</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profit</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-200">
                    {% if positions %} 
                      {% for pos in positions %}
                      <tr class="hover:bg-gray-50">
                        <td class="py-3 px-4 whitespace-nowrap">{{ pos.ticket }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ pos.symbol }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">
                          <span class="px-2 py-1 text-xs rounded-full {{ 'bg-green-100 text-green-800' if pos.type == 'BUY' else 'bg-red-100 text-red-800' }}">
                            {{ pos.type }}
                          </span>
                        </td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ pos.volume }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ pos.price_open }}</td>
                        <td class="py-3 px-4 whitespace-nowrap text-xs">
                          <div>SL: <span class="font-medium">{{ pos.sl }}</span></div>
                          <div>TP: <span class="font-medium">{{ pos.tp }}</span></div>
                        </td>
                        <td class="py-3 px-4 whitespace-nowrap font-medium {{ 'text-green-600' if pos.profit >= 0 else 'text-red-600' }}"></td>
                          {{ pos.profit }}
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr>
                        <td colspan="7" class="py-8 text-center text-gray-500">
                          <i class="fas fa-info-circle mr-2"></i>No open positions
                        </td>
                      </tr>
                    {% endif %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- History Section -->
          <div id="history" class="dashboard-section hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-history mr-2 text-primary"></i>Trading History
              </h2>
              <p class="text-sm text-gray-500">Last {{ history|length if history else 0 }} trades</p>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full">
                  <thead>
                    <tr class="bg-gray-50">
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbol</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exit</th>
                      <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profit</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-200">
                    {% if history %}
                      {% for trade in history %}
                      <tr class="hover:bg-gray-50">
                        <td class="py-3 px-4 whitespace-nowrap">{{ trade.ticket }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ trade.symbol }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">
                          <span class="px-2 py-1 text-xs rounded-full {{ 'bg-green-100 text-green-800' if trade.type == 'BUY' else 'bg-red-100 text-red-800' }}">
                            {{ trade.type }}
                          </span>
                        </td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ trade.volume }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ trade.price_open }}</td>
                        <td class="py-3 px-4 whitespace-nowrap">{{ trade.price_close }}</td>
                        <td class="py-3 px-4 whitespace-nowrap font-medium {{ 'text-green-600' if trade.profit >= 0 else 'text-red-600' }}">
                          {{ trade.profit }}
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr>
                        <td colspan="7" class="py-8 text-center text-gray-500">
                          <i class="fas fa-info-circle mr-2"></i>No trade history
                        </td>
                      </tr>
                    {% endif %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Account Section -->
          <div id="account" class="dashboard-section hidden">
            <div class="mb-6">
              <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-wallet mr-2 text-primary"></i>Account Information
              </h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center mb-4">
                  <div class="mr-4 p-3 bg-blue-100 text-blue-600 rounded-full">
                    <i class="fas fa-dollar-sign"></i>
                  </div>
                  <div>
                    <h3 class="text-sm font-semibold text-gray-500">Balance</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ account.balance if account else 'N/A' }}</p>
                  </div>
                </div>
                <div class="text-sm text-gray-500">
                  <i class="fas fa-info-circle mr-1"></i>Total account balance without unrealized P/L
                </div>
              </div>
              
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center mb-4">
                  <div class="mr-4 p-3 bg-green-100 text-green-600 rounded-full">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <div>
                    <h3 class="text-sm font-semibold text-gray-500">Equity</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ account.equity if account else 'N/A' }}</p>
                  </div>
                </div>
                <div class="text-sm text-gray-500">
                  <i class="fas fa-info-circle mr-1"></i>Balance + unrealized profit/loss
                </div>
              </div>
              
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center mb-4">
                  <div class="mr-4 p-3 bg-yellow-100 text-yellow-600 rounded-full">
                    <i class="fas fa-lock"></i>
                  </div>
                  <div>
                    <h3 class="text-sm font-semibold text-gray-500">Margin</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ account.margin if account else 'N/A' }}</p>
                  </div>
                </div>
                <div class="text-sm text-gray-500">
                  <i class="fas fa-info-circle mr-1"></i>Margin required for open positions
                </div>
              </div>
              
              <div class="dashboard-card bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center mb-4">
                  <div class="mr-4 p-3 bg-purple-100 text-purple-600 rounded-full">
                    <i class="fas fa-hand-holding-usd"></i>
                  </div>
                  <div>
                    <h3 class="text-sm font-semibold text-gray-500">Free Margin</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ account.margin_free if account else 'N/A' }}</p>
                  </div>
                </div>
                <div class="text-sm text-gray-500">
                  <i class="fas fa-info-circle mr-1"></i>Available margin for new positions
                </div>
              </div>
            </div>
          </div>
          
          <!-- Configuration Section -->
          <div id="config" class="dashboard-section hidden">
            <div class="mb-6">
              <h2 class="text-xl font-bold text-gray-800">
                <i class="fas fa-cog mr-2 text-primary"></i>Bot Configuration
              </h2>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6">
              <form action="/update_config" method="post" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {% for key, val in config.items() %}
                  <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                      {{ key.replace('_', ' ').title() }}:
                    </label>
                    <input 
                      name="{{ key }}" 
                      value="{{ val }}" 
                      class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none transition"
                    />
                  </div>
                  {% endfor %}
                </div>
                <button type="submit" class="w-full md:w-auto mt-6 px-6 py-2 bg-primary text-white rounded-md shadow-sm hover:bg-primary/90 transition flex items-center justify-center">
                  <i class="fas fa-save mr-2"></i>
                  Update Configuration
                </button>
              </form>
            </div>
          </div>
                  <div class="bottom-4 left-4 right-4">
          <div class="bg-gray-100 p-3 rounded-lg">
            <div class="flex items-center">
              <div class="mr-3 bg-primary text-white p-2 rounded-full">
                <i class="fas fa-robot"></i>
              </div>
              <div>
                <p class="text-sm font-medium">Bot Status</p>
                <div class="status-badge {{ 'status-running' if status == 'running' else 'status-stopped' }}">
                  {{ status.upper() }}
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </main>
    </div>

    <script>
      // collapse sidebar on mobile
      document.getElementById('nav-toggle').addEventListener('click',()=>{
        document.querySelector('aside').classList.toggle('hidden');
      });

      // Navigation functionality
      function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.dashboard-section').forEach(section => {
          section.classList.add('hidden');
        });
        
        // Show selected section
        document.getElementById(sectionId).classList.remove('hidden');
        
        // Highlight active nav button
        document.querySelectorAll('.nav-btn').forEach(btn => {
          btn.classList.remove('bg-gray-100', 'font-semibold');
        });
        event.currentTarget.classList.add('bg-gray-100', 'font-semibold');
      }
      
      // Set initial section to market structure
      document.addEventListener("DOMContentLoaded", function() {
        showSection('market_structure');
      });
    </script>
  </body>
</html>
